<html>
    <head>
        <title></title>
        <style>
                .background {
                        margin: 0; padding: 0; border: 0; background: none;
                        position: absolute; top: 0; left: 0;
                        z-index: -100000;
                }
        /*
            .espui * {
                margin: 10; padding: 0; border: 0; background: none;
                font-family: 'Courier New', Courier, monospace;
                display: block;
                float: left;
                font-size: 1em;
                line-height: 2em;
            }

            .espui {
                    background-color: lightgray;
            }

            .espui fieldset {
                border: 1px inset gray;
                padding: 0 2em;
            }

            .espui legend {
                float: none;
                font-weight: bold;
            }

            .espui label {
                width: 10em;
            }
            .espui br {
                float: none;
                clear: both;
            }

            .espui input {
                width: 10em;
            }

            .espui input[type="button"] {
                border: 1px solid black;
            }
*/
        </style>
        <script>
        resizeBackground = () => {
                 document.querySelector('[name="background1"]').setAttribute('height', '0');
                document.querySelector('[name="background1"]').setAttribute('height', document.body.scrollHeight);
        }
        </script>
    </head>
    <body class="espui" onload="resizeBackground()" onresize="resizeBackground()">
        <svg name="common" width="0" height="0" >
            <defs>
                <linearGradient id="gradient-gray-button-down" x1="80%" y1="116%" x2="0%" y2="0%">
                    <stop offset="0%" style="stop-color:black;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:gray;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="gradient-gray-button-up" x1="80%" y1="116%" x2="0%" y2="0%">
                    <stop offset="0%" style="stop-color:black;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:darkgray;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="gradient-gray-switch-background" x1="0%" y1="0%" x2="80%" y2="116%">
                    <stop offset="0%" style="stop-color:gray;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:lightgray;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="gradient-scope-background-green" x1="0%" y1="0%" x2="80%" y2="116%">
                    <stop offset="0%" style="stop-color:black;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:darkgreen;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="gradient-scope-background-blue" x1="0%" y1="0%" x2="80%" y2="116%">
                    <stop offset="0%" style="stop-color:black;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:darkblue;stop-opacity:1" />
                </linearGradient>
                <filter id="filter-scope-line" x="0" y="0">
                      <feOffset result="offOut" in="SourceGraphic" dx="0" dy="0" />
                      <feGaussianBlur result="blurOut" in="offOut" stdDeviation="2" />
                      <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
                </filter>
                <filter id='noize' x='0' y='0'>
                        <feTurbulence type='fractalNoise' baseFrequency='0.7' numOctaves='10' stitchTiles='stitch'/>
                </filter>
             </defs>
        </svg>


        <svg name="background1" class="background"
            width="100%" >
                <rect x="0" y="0" rx="0" ry="0" width="100%" height="100%"
                         stroke="gray" stroke-width="0" 
                         filter="url(#noize)" />
        </svg>


        <svg name="button1"
            width="40" 
            height="40" 
            onmousedown="document.querySelectorAll('[name=button1] circle')[1].setAttribute('style', 'display: block;');" 
            onmouseup="document.querySelectorAll('[name=button1] circle')[1].setAttribute('style', 'display: none;');">
            
            <circle cx="50%" cy="50%" r="44%" stroke="gray" stroke-width="3%" fill="url(#gradient-gray-button-up)"/>
            <circle cx="50%" cy="50%" r="44%" stroke="gray" stroke-width="3%" fill="url(#gradient-gray-button-down)" style="display: none;" />
        </svg>
        
        <svg name="swich1"
            width="80" 
            height="40"
            onmousedown="document.querySelectorAll('[name=swich1] circle')[1].setAttribute('style', 'display: block;');" 
            onmouseup="
                let elems = document.querySelectorAll('[name=swich1] circle');
                elems[1].setAttribute('style', 'display: none;');
                let p = '75%';
                if (elems[0].getAttribute('cx') == '75%') p = '25%';
                elems[0].setAttribute('cx', p);
                elems[1].setAttribute('cx', p);
            ">
                <rect x="1.5%" y="3%" rx="25%" ry="50%" width="97%" height="94%"
                         stroke="gray" stroke-width="3%" fill="url(#gradient-gray-switch-background)" />
                
            <circle cx="75%" cy="50%" r="27%" stroke="gray" stroke-width="1%" fill="url(#gradient-gray-button-up)"/>
            <circle cx="75%" cy="50%" r="27%" stroke="gray" stroke-width="1%" fill="url(#gradient-gray-button-down)" style="display: none;" />
        </svg>

        <svg name="scope1"
            width="300" 
            height="200" style="
                border:2px inset;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
             ">
                <rect x="0" y="0" width="100%" height="100%"
                         stroke-width="0" fill="url(#gradient-scope-background-green)" />
                
                <path d="
                        M 0 50 H 300
                        M 0 100 H 300
                        M 0 150 H 300
                        M 50 0 V 200
                        M 100 0 V 200
                        M 150 0 V 200
                        M 200 0 V 200
                        M 250 0 V 200
                " stroke="darkgreen" stroke-width="1" fill="none"
                 filter="url(#filter-scope-line)" />

                <text x="2" y="48" fill="darkcyan" filter="url(#filter-scope-line)">30</text>
                <text x="2" y="98" fill="darkcyan" filter="url(#filter-scope-line)">20</text>
                <text x="2" y="148" fill="darkcyan" filter="url(#filter-scope-line)">10</text>
                <text x="2" y="198" fill="darkcyan" filter="url(#filter-scope-line)">0</text>
                <text x="52" y="198" fill="darkcyan" filter="url(#filter-scope-line)">10</text>
                <text x="102" y="198" fill="darkcyan" filter="url(#filter-scope-line)">20</text>
                <text x="152" y="198" fill="darkcyan" filter="url(#filter-scope-line)">30</text>
                <text x="202" y="198" fill="darkcyan" filter="url(#filter-scope-line)">40</text>
                <text x="252" y="198" fill="darkcyan" filter="url(#filter-scope-line)">50</text>

                <text x="298" y="48" text-anchor="end" fill="green" filter="url(#filter-scope-line)">15</text>
                <text x="298" y="98" text-anchor="end" fill="green" filter="url(#filter-scope-line)">10</text>
                <text x="298" y="148" text-anchor="end" fill="green" filter="url(#filter-scope-line)">5</text>
                <text x="298" y="198" text-anchor="end" fill="green" filter="url(#filter-scope-line)">0</text>
                <text x="2" y="1em" fill="green" filter="url(#filter-scope-line)">0</text>
                <text x="52" y="1em" fill="green" filter="url(#filter-scope-line)">5</text>
                <text x="102" y="1em" fill="green" filter="url(#filter-scope-line)">10</text>
                <text x="152" y="1em" fill="green" filter="url(#filter-scope-line)">15</text>
                <text x="202" y="1em" fill="green" filter="url(#filter-scope-line)">20</text>
                <text x="252" y="1em" fill="green" filter="url(#filter-scope-line)">25</text>

                 <path d="
                        M 0 10
                        L 20 20 
                        L 40 25
                        L 60 40 
                        L 80 50 
                        L 100 70 
                        L 120 100
                        L 140 123
                        L 160 140
                        L 180 150
                        L 200 155
                        L 220 160
                        L 240 170
                        L 260 180
                        L 280 185
                        L 300 170
                    "
                    stroke="cyan" stroke-width="2" fill="none" 
                    filter="url(#filter-scope-line)"/>

                 <path d="
                        M 0 130
                        L 20 120 
                        L 40 115
                        L 60 110 
                        L 80 108 
                        L 100 105 
                        L 120 104
                        L 140 100
                        L 160 80
                        L 180 60
                        L 200 30
                        L 220 28
                        L 240 25
                        L 260 29
                        L 280 45
                        L 300 73
                    "
                    stroke="lightgreen" stroke-width="2" fill="none" 
                    filter="url(#filter-scope-line)"/>
              
        </svg>
        
        <svg name="scope1"
            width="300" 
            height="200" style="
                border:2px inset;
                font-family: 'Courier New', Courier, monospace;
                font-size: 1em;
             ">
                <rect x="0" y="0" width="100%" height="100%"
                         stroke-width="0" fill="url(#gradient-scope-background-blue)" />
                
                <path d="
                        M 0 50 H 300
                        M 0 100 H 300
                        M 0 150 H 300
                        M 50 0 V 200
                        M 100 0 V 200
                        M 150 0 V 200
                        M 200 0 V 200
                        M 250 0 V 200
                " stroke="darkblue" stroke-width="1" fill="none"
                 filter="url(#filter-scope-line)" />

                <text x="2" y="48" fill="darkcyan" filter="url(#filter-scope-line)">30</text>
                <text x="2" y="98" fill="darkcyan" filter="url(#filter-scope-line)">20</text>
                <text x="2" y="148" fill="darkcyan" filter="url(#filter-scope-line)">10</text>
                <text x="2" y="198" fill="darkcyan" filter="url(#filter-scope-line)">0</text>
                <text x="52" y="198" fill="darkcyan" filter="url(#filter-scope-line)">10</text>
                <text x="102" y="198" fill="darkcyan" filter="url(#filter-scope-line)">20</text>
                <text x="152" y="198" fill="darkcyan" filter="url(#filter-scope-line)">30</text>
                <text x="202" y="198" fill="darkcyan" filter="url(#filter-scope-line)">40</text>
                <text x="252" y="198" fill="darkcyan" filter="url(#filter-scope-line)">50</text>

                <text x="298" y="48" text-anchor="end" fill="green" filter="url(#filter-scope-line)">15</text>
                <text x="298" y="98" text-anchor="end" fill="green" filter="url(#filter-scope-line)">10</text>
                <text x="298" y="148" text-anchor="end" fill="green" filter="url(#filter-scope-line)">5</text>
                <text x="298" y="198" text-anchor="end" fill="green" filter="url(#filter-scope-line)">0</text>
                <text x="2" y="1em" fill="green" filter="url(#filter-scope-line)">0</text>
                <text x="52" y="1em" fill="green" filter="url(#filter-scope-line)">5</text>
                <text x="102" y="1em" fill="green" filter="url(#filter-scope-line)">10</text>
                <text x="152" y="1em" fill="green" filter="url(#filter-scope-line)">15</text>
                <text x="202" y="1em" fill="green" filter="url(#filter-scope-line)">20</text>
                <text x="252" y="1em" fill="green" filter="url(#filter-scope-line)">25</text>

                 <path d="
                        M 0 10
                        L 20 20 
                        L 40 25
                        L 60 40 
                        L 80 50 
                        L 100 70 
                        L 120 100
                        L 140 123
                        L 160 140
                        L 180 150
                        L 200 155
                        L 220 160
                        L 240 170
                        L 260 180
                        L 280 185
                        L 300 170
                    "
                    stroke="cyan" stroke-width="2" fill="none" 
                    filter="url(#filter-scope-line)"/>

                 <path d="
                        M 0 130
                        L 20 120 
                        L 40 115
                        L 60 110 
                        L 80 108 
                        L 100 105 
                        L 120 104
                        L 140 100
                        L 160 80
                        L 180 60
                        L 200 30
                        L 220 28
                        L 240 25
                        L 260 29
                        L 280 45
                        L 300 73
                    "
                    stroke="lightgreen" stroke-width="2" fill="none" 
                    filter="url(#filter-scope-line)"/>
              
        </svg>

        <br>
        
        <svg id="svg-scope-test"></svg>
        <script>
            class SvgScope {
                static nextId = 0;
                constructor(selector, width, height, rasterx, rastery, theme, dataset, maxDatasetLength) {
                    if (typeof selector === 'undefined') throw 'Missing selector';
                    if (typeof width === 'undefined') throw 'Missing width';
                    if (typeof height === 'undefined') throw 'Missing height';
                    if (typeof theme === 'undefined') throw 'Missing theme';
                    if (typeof theme.bgStart === 'undefined') throw 'Missing theme.background';
                    if (typeof theme.bgEnd === 'undefined') throw 'Missing theme.bgEnd';
                    if (typeof theme.raster === 'undefined') throw 'Missing theme.raster';
                    if (typeof theme.value === 'undefined') throw 'Missing theme.value';
                    if (typeof theme.error === 'undefined') throw 'Missing theme.error';
                    if (typeof maxDatasetLength === 'undefined') throw 'Missing maxDatasetLength';
                    let svgList = document.querySelectorAll(selector);
                    if (!svgList.length) throw "SVG element not found by selector '" + selector + "'";
                    svgList.forEach((svg) => {
                        if (!(svg instanceof SVGElement)) throw "A selected element by selector '" + selector + "' is not an SVGElement";
                        svg.setAttribute('width', width);
                        svg.setAttribute('height', height); 
                        svg.setAttribute('style', "border:2px inset; font-family: 'Courier New', Courier, monospace; font-size: 1em;");
                        let svgns = 'http://www.w3.org/2000/svg';
                        let rect = document.createElementNS(svgns, 'rect');
                        rect.setAttribute('x', 0);
                        rect.setAttribute('y', 0);
                        rect.setAttribute('width', '100%');
                        rect.setAttribute('height', '100%');
                        rect.setAttribute('stroke-width', 0);
                        let linearGradient = document.createElementNS(svgns, 'linearGradient');
                        let id;
                        while (document.querySelectorAll('#' + (id = 'svg-scope-linear-gradient-' + (SvgScope.nextId++))).length);
                        linearGradient.setAttribute('id', id);
                        linearGradient.setAttribute('x1', '-10%');
                        linearGradient.setAttribute('y1', '-10%');
                        linearGradient.setAttribute('x2', '80%');
                        linearGradient.setAttribute('y2', '116%');
                        let defs = document.createElementNS(svgns, 'defs');
                        let stop = document.createElementNS(svgns, 'stop');
                        stop.setAttribute('offset', '0%');
                        stop.setAttribute('style', 'stop-color:' + theme.bgStart + ';stop-opacity:1');
                        linearGradient.appendChild(stop);
                        stop = document.createElementNS(svgns, 'stop');
                        stop.setAttribute('offset', '100%');
                        stop.setAttribute('style', 'stop-color:' + theme.bgEnd + ';stop-opacity:1');
                        linearGradient.appendChild(stop);
                        defs.appendChild(linearGradient);
                        svg.appendChild(defs);
                        rect.setAttribute('fill', 'url(#' + id + ')');
                        svg.appendChild(rect);

                        let p0 = width/(rasterx);
                        let p = 0;
                        let d = '';
                        for (let i=1; i<rasterx; i++) {
                            p += p0;
                            d += 'M ' + p + ' 0 V ' + height; 
                        }
                        p0 = height/(rastery);
                        p = 0;
                        for (let i=1; i<rastery; i++) {
                            p += p0;
                            d += 'M 0 ' + p + ' H ' + width;
                        }
                        let pathRaster = document.createElementNS(svgns, 'path');
                        pathRaster.setAttribute('d', d);
                        pathRaster.setAttribute('stroke', theme.raster);
                        pathRaster.setAttribute('stroke-width', '1');
                        pathRaster.setAttribute('fill', 'none');
                        
                        let filter = document.createElementNS(svgns, 'filter');
                        while (document.querySelectorAll('#' + (id = 'svg-scope-filter-' + (SvgScope.nextId++))).length);
                        filter.setAttribute('id', id);
                        filter.setAttribute('x', 0);
                        filter.setAttribute('y', 0);
                        let feOffset = document.createElementNS(svgns, 'feOffset');
                        feOffset.setAttribute('result', 'offOut');
                        feOffset.setAttribute('in', 'SourceGraphic');
                        feOffset.setAttribute('dx', 0);
                        feOffset.setAttribute('dy', 0);
                        filter.appendChild(feOffset);
                        let feGaussianBlur = document.createElementNS(svgns, 'feGaussianBlur');
                        feGaussianBlur.setAttribute('result', 'blurOut');
                        feGaussianBlur.setAttribute('in', 'offOut');
                        feGaussianBlur.setAttribute('stdDeviation', 2);
                        filter.appendChild(feGaussianBlur);
                        let feBlend = document.createElementNS(svgns, 'feBlend');
                        feBlend.setAttribute('in', 'SourceGraphic');
                        feBlend.setAttribute('in2', 'blurOut');
                        feBlend.setAttribute('mode', 'normal');
                        filter.appendChild(feBlend);
                        defs.appendChild(filter);
                        pathRaster.setAttribute('filter', 'url(#' + id + ')');
                        svg.appendChild(pathRaster);

                        let pathValue = document.createElementNS(svgns, 'path');
                        pathValue.setAttribute('stroke', theme.value);
                        pathValue.setAttribute('stroke-width', '2');
                        pathValue.setAttribute('fill', 'none');
                        pathValue.setAttribute('filter', 'url(#' + id + ')');
                        svg.appendChild(pathValue);


                        let textError = document.createElementNS(svgns, 'text');
                        textError.setAttribute('x', 0);
                        textError.setAttribute('y', '1em');
                        textError.setAttribute('fill', theme.error);
                        textError.setAttribute('filter', 'url(#' + id + ')');
                        svg.appendChild(textError);

                        this.width = width;
                        this.height = height;
                        this.maxDatasetLength = maxDatasetLength;
                        this.pathValue = pathValue;
                        this.textError = textError;
                        this.set(dataset);
                    });
                }
                set(dataset) {
                    if (typeof dataset === 'undefined') throw 'Missing dataset';
                    this.dataset = dataset;
                    this.show();
                }
                add(dataset) {
                    if (typeof dataset === 'undefined') throw 'Missing dataset';
                    this.dataset = this.dataset.concat(dataset);
                    this.show();
                }
                show() {
                    for (let i=1; i<this.dataset.length; i++) {
                        if (this.dataset[i-1][0] > this.dataset[i][0]) {
                            let tmp = this.dataset[i];
                            this.dataset[i] = this.dataset[i-1];
                            this.dataset[i-1] = tmp;
                            i-=2;
                            if (i<0) i=0;
                        } else if (this.dataset[i-1][0] == this.dataset[i][0]) {
                            this.dataset.splice(i-1, 1);
                            i-=2;
                            if (i<0) i=0;
                        }
                    }

                    if (this.dataset.length > this.maxDatasetLength) {
                        this.dataset.splice(0, this.dataset.length - this.maxDatasetLength);
                    }

                    let xmin = Number.POSITIVE_INFINITY;
                    let xmax = Number.NEGATIVE_INFINITY;
                    let ymin = Number.POSITIVE_INFINITY;
                    let ymax = Number.NEGATIVE_INFINITY;
                    for (let i=0; i<this.dataset.length; i++) {
                        if (xmin > this.dataset[i][0]) xmin = this.dataset[i][0];
                        if (xmax < this.dataset[i][0]) xmax = this.dataset[i][0];
                        if (ymin > this.dataset[i][1]) ymin = this.dataset[i][1];
                        if (ymax < this.dataset[i][1]) ymax = this.dataset[i][1];
                    }

                    let d = '';
                    let xdiff = xmax - xmin;
                    let ydiff = ymax - ymin;
                    let errmsg = '';
                    if (xdiff && ydiff) {
                        let ratiox = this.width / xdiff;
                        let ratioy = this.height / ydiff;
                        for (let i=0; i<this.dataset.length; i++) {
                            d += (i ? ' L ' : ' M ') + ((this.dataset[i][0]-xmin) * ratiox) + ' ' + (this.height - ((this.dataset[i][1]-ymin) * ratioy));
                        }
                    } else errmsg = 'INF';
                    this.error(errmsg);
                    

                    this.pathValue.setAttribute('d', d);
                }
                error(msg) {
                    this.textError.innerHTML = msg;
                }
            }

            // ----
            let generatorStateX = 0;
            let generatorStateY = 0;
            let generateData = (size) => {
                let dataset = [];
                for (let i=0; i<size; i++) {
//                     dataset.push([generatorStateX++, generatorStateY++]);
                    dataset.push([generatorStateX++, Math.floor(Math.random() * 256) - 128]);
                    if (generatorStateY>10)generatorStateY = 0;
                }
                return dataset;
            };
            
            svgScope1 = new SvgScope('#svg-scope-test', 600, 400, 12, 8, {
                bgStart: 'black',
                bgEnd: 'darkblue',
                raster: 'darkblue',
                value: 'cyan',
                error: 'red',
            }, generateData(0), 50/*Number.POSITIVE_INFINITY*/);

            let counter = 10000;
            let interval = setInterval(() => {
                svgScope1.add(generateData(1));
                counter--;
                if (!counter) clearInterval(interval);
            }, 1);

            
        </script>



        <br>

        <fieldset>
            <legend>legend</legend>
                
            <label>button</label>
            <input type="button" value="Button">
            <br>
            
            <label>checkbox</label>
            <input type="checkbox">
            <br>
            
            <label>color</label>
            <input type="color">
            <br>
            
            <label>date</label>
            <input type="date">
            <br>
            
            <label>datetime-local</label>
            <input type="datetime-local">
            <br>
            
            <label>email</label>
            <input type="email">
            <br>
            
            <label>file</label>
            <input type="file">
            <br>
            
            <label>hidden</label>
            <input type="hidden">
            <br>
            
            <label>image</label>
            <input type="image">
            <br>
            
            <label>month</label>
            <input type="month">
            <br>

            <label>number</label>
            <input type="number">
            <br>
            
            <label>password</label>
            <input type="password">
            <br>
            
            <label>radio</label>
            <input type="radio">
            <br>
            
            <label>range</label>
            <input type="range">
            <br>

            <label>range vertical</label>
            <style>
                input[type=range][orient=vertical]
                {
                    writing-mode: bt-lr; /* IE */
                    -webkit-appearance: slider-vertical; /* WebKit */
                    width: 16px;
                    height: 129px;
                    margin: 2px;
                }
            </style>
            <input type="range" orient="vertical" />
            <br>
            
            <label>reset</label>
            <input type="reset">
            <br>
            
            <label>search</label>
            <input type="search">
            <br>
            
            <label>submit</label>
            <input type="submit">
            <br>
            
            <label>tel</label>
            <input type="tel">
            <br>
            
            <label>text</label>
            <input type="text">
            <br>
            
            <label>time</label>
            <input type="time">
            <br>
            
            <label>url</label>
            <input type="url">
            <br>
            
            <label>week</label>
            <input type="week">
            <br>

            <label>select</label>
            <select>
                <option>Volvo</option>
                <option>Saab</option>
                <option>Fiat</option>
                <option>Audi</option>
            </select>
            <br>

            <label>select multiple</label>
            <select multiple>
                <option>Volvo</option>
                <option>Saab</option>
                <option>Fiat</option>
                <option>Audi</option>
            </select>
            <br>

            <label>select optgroup</label>
            <select>
            <optgroup label="Swedish Cars">
                <option value="volvo">Volvo</option>
                <option value="saab">Saab</option>
            </optgroup>
            <optgroup label="German Cars">
                <option value="mercedes">Mercedes</option>
                <option value="audi">Audi</option>
            </optgroup>
            </select>
            <br>

            <label>textarea</label>
            <textarea>
                The cat was playing in the garden.
            </textarea>
            <br>

            <label>button</label>
            <button>Click Me!</button>
            <br>

            <label>datalist</label>
            <input list="browsers">
            <datalist id="browsers">
                <option value="Internet Explorer">
                <option value="Firefox">
                <option value="Chrome">
                <option value="Opera">
                <option value="Safari">
            </datalist>
            <br>

            <label>output</label>
            <output>output</output>
            <br>

        </fieldset>
    </body>
</html>
